# –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω

```bash
curl http://localhost:8080/health
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: `OK`

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
```bash
RUST_LOG=info cargo run
```

–ò–ª–∏ –¥–ª—è debug:
```bash
RUST_LOG=debug cargo run
```

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —Ñ–∞–π–ª–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–ª—é—á–∏:

```bash
grep -E "GROK_API_KEY|STT_API_KEY|TTS_API_KEY" .env
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã:
- `GROK_API_KEY` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è LLM
- `STT_API_KEY` - –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∞—É–¥–∏–æ)
- `TTS_API_KEY` - –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏

## –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ HTML –∫–ª–∏–µ–Ω—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ `insomnia/websocket_test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å Hello"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   INFO New WebSocket connection
   INFO Received hello message: ...
   INFO Session created: ...
   ```

5. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç (Listen)"
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   INFO Processing listen text: '–≤–∞—à —Ç–µ–∫—Å—Ç'
   INFO Calling LLM service with 1 messages
   INFO POST https://api.x.ai/v1/chat/completions
   INFO Grok API response status: 200
   INFO LLM response received: '–æ—Ç–≤–µ—Ç'
   INFO Sending LLM message: {"type":"llm",...}
   INFO LLM message sent successfully
   ```

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±—Ä–∞—É–∑–µ—Ä

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console) –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
- `‚úÖ Hello –ø—Ä–∏–Ω—è—Ç! Session ID: ...`
- `ü§ñ –û—Ç–≤–µ—Ç LLM: "..."`

–í–æ –≤–∫–ª–∞–¥–∫–µ Network ‚Üí WS –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã:
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∑–µ–ª–µ–Ω—ã–µ)
- –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∂–µ–ª—Ç—ã–µ)

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Failed to send LLM message to WebSocket"

**–ü—Ä–∏—á–∏–Ω–∞:** WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "LLM service error: Grok API error: 401"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π API –∫–ª—é—á

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á
grep GROK_API_KEY .env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
RUST_LOG=info cargo run 2>&1 | grep -i "grok\|api_key"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Empty LLM response"

**–ü—Ä–∏—á–∏–Ω–∞:** LLM –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –Ω–æ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ –∑–∞–∫—Ä—ã—Ç–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ù–µ—Ç –ª–æ–≥–æ–≤ –≤–æ–æ–±—â–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
export RUST_LOG=info
cargo run
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: API –∫–ª—é—á–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–π
cat .env | grep -E "GROK_API_KEY|STT_API_KEY|TTS_API_KEY"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é

```bash
# –¢–µ—Å—Ç Grok API
curl -X POST https://api.x.ai/v1/chat/completions \
  -H "Authorization: Bearer YOUR_GROK_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "grok-beta",
    "messages": [{"role": "user", "content": "Hello"}],
    "max_tokens": 100
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
RUST_LOG=info cargo run 2>&1 | tee server.log

# –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
grep -E "LLM|STT|TTS|WebSocket|error" server.log
```

## –û–∂–∏–¥–∞–µ–º—ã–π –ø–æ—Ç–æ–∫ –ª–æ–≥–æ–≤:

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Listen:

```
INFO New WebSocket connection
INFO Received hello message: HelloMessage { ... }
INFO Session created: 550e8400-...
INFO Processing listen text: '–ü—Ä–∏–≤–µ—Ç'
INFO Calling LLM service with 1 messages
INFO Message: role=user, content=–ü—Ä–∏–≤–µ—Ç...
INFO POST https://api.x.ai/v1/chat/completions
INFO Grok API response status: 200
INFO Grok API response: 1 choices
INFO Extracted content: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?'
INFO Sending LLM message: {"type":"llm","session_id":"...","text":"–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"}
INFO LLM message sent successfully
INFO Synthesizing TTS for response: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?'
INFO TTS audio synthesized: 1234 bytes
INFO Sending TTS audio: 1234 bytes
INFO TTS audio sent successfully
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –≤—ã—à–µ.

